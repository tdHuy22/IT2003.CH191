# SYN cookies + backlog
sysctl -w net.ipv4.tcp_syncookies=1
sysctl -w net.ipv4.tcp_max_syn_backlog=4096
sysctl -w net.core.somaxconn=4096

# conntrack table cho nhiều client IoT
sysctl -w net.netfilter.nf_conntrack_max=262144

# giảm TIME_WAIT giữ kết nối
sysctl -w net.ipv4.tcp_fin_timeout=15
sysctl -w net.ipv4.tcp_tw_reuse=1

table inet filter {
  chain input {
    type filter hook input priority 0;
    tcp flags syn tcp option maxseg size set 1460
    tcp flags syn ct state new limit rate over 100/second drop
  }
}
